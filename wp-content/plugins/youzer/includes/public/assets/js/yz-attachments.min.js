!function(d){"use strict";d(document).ready(function(){var a=0,t=null;d.ajaxPrefilter(function(e,a,t){if(a.hasOwnProperty("data")&&a.data.hasOwnProperty("action")){var n=a.data.action;if("new_activity_comment"==n)0!=(i=d("#ac-form-"+a.data.form_id).find('input[name="attachments_files[]"]').map(function(e,a){return d(a).val()}).get()).length&&(e.data+="&attachments_files="+i,""==a.data.content&&(e.data+="&content={{{yz_comment_attachment}}}"));else if("messages_send_reply"==n){var i;0!=(i=d("#send-reply").find('input[name="attachments_files[]"]').map(function(e,a){return d(a).val()}).get()).length&&(e.data+="&attachments_files="+i,""==a.data.content&&(e.data+="&content={{{yz_message_attachment}}}"))}}}),d(document).ajaxSuccess(function(e,a,t){if("[object String]"==Object.prototype.toString.call(t.data)){var n=a.responseText;if(n[0]+n[1]!="-1"){var i=d.yz_getUrlParameter(t.data,"action");"new_activity_comment"==i?(d("#ac-form-"+d.yz_getUrlParameter(t.data,"form_id")).find(".yz-delete-attachment").trigger("click"),d("#ac-form-"+d.yz_getUrlParameter(t.data,"form_id")).find(".yz-wall-upload-btn").fadeIn()):"messages_send_reply"==i&&(d("#send-reply").find(".yz-delete-attachment").trigger("click"),d("#send-reply").find(".yz-upload-btn").fadeIn())}}}),d(document).on("change",".yz-upload-attachments",function(e){e.preventDefault();var a=d(this).closest("form");if(a.hasClass("ac-form")&&(a.find(".yz-wall-upload-btn").fadeOut(),a.find(".yz-attachment-item")[0]))return!1;t=d(this).get(0),d.yz_UploadFiles(d(this).closest("form"),{attachments:t})}),d.yz_UploadFiles=function(e,a){for(var t=d.extend({},a).attachments.files,n=0;n<t.length;n++){var i=t[n];if(e.hasClass("yz-wall-form")){if(!d.yz_CheckFilesNumber(e))return!1}else if(e.find(".yz-attachment-item")[0])return!1;var s=d.youzerAttachmentItem({file:i,file_name:i.name});e.hasClass("ac-form")?e.find(".yz-wall-upload-btn").fadeOut(1):"send-reply"!=e.attr("id")&&"send_message_form"!=e.attr("id")||e.find(".yz-upload-btn").fadeOut(1),e.find(".yz-form-attachments").append(s),0==n&&d.yz_UploadFile(e,i)}},d.youzerAttachmentItem=function(e){var a,t=d.extend({},e);return a='<div class="yz-attachment-item yz-file-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i><span class="yz-file-name">'+d.yz_GetNameExcerpt(t.file_name)+'</span></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>','<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>',d.yz_CheckIsFileImage(t.file)?'<div class="yz-attachment-item yz-image-preview"><div class="yz-attachment-details"><i class="fas fa-hourglass-half yz-file-icon"></i></div><div class="yz-file-progress"><span class="yz-file-upload"></span></div><input type="hidden" class="yz-attachment-data" name="attachments_files[]" /></div>':a},d.yz_UploadFile=function(i,r){var l=i.find(".yz-file-progress:first").parent(".yz-attachment-item"),e=new FormData;e.append("file",r),i.hasClass("yz-wall-form")?(e.append("target","activity"),e.append("post_type",i.find('input:radio[name="post_type"]:checked').val())):i.hasClass("ac-form")?e.append("target","comment"):"send-reply"!=i.closest("form").attr("id")&&"send_message_form"!=i.closest("form").attr("id")||e.append("target","message"),e.append("attachments_number",i.find(".yz-attachment-item").length),e.append("action","yz_upload_wall_attachments"),e.append("security",Youzer.security_nonce),d.ajax({type:"POST",url:Youzer.ajax_url,data:e,cache:!1,contentType:!1,processData:!1,xhr:function(){var e=d.ajaxSettings.xhr();return e.upload&&(i.find(".yz-wall-post,.yz-update-post").attr("disabled",!0),e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var a=e.total,t=100*e.loaded/a,n=l.find(".yz-file-upload");l.find(".yz-file-icon").attr("class","fas fa-spinner fa-spin yz-file-icon"),n.css("width",t+"%"),100<=t&&n.addClass("yz-file-uploaded")}})),e},success:function(e){var a=d.parseJSON(e);if(a.error)return d.yz_DialogMsg("error",a.error),i.hasClass("ac-form")?i.find(".yz-wall-upload-btn").fadeIn():"send-reply"!=i.attr("id")&&"send_message_form"!=i.attr("id")||i.find(".yz-upload-btn").fadeIn(),l.remove(),d.yz_CheckUploadProgress(i),!1;var t=a.base_url;l.find(".yz-file-progress").fadeOut(400,function(){d(this).remove(),d.yz_upload_next_file(i),d.yz_CheckUploadProgress(i)}),d.yz_CheckIsFileImage(r)&&l.find(".yz-file-icon").remove(),l.find(".yz-file-icon").attr("class","fas fa-paperclip yz-file-icon"),l.find(".yz-attachment-details").append('<i class="fas fa-trash-alt yz-delete-attachment"></i>'),delete a.base_url,l.find(".yz-attachment-data").val(JSON.stringify(a));var n=new FileReader;r.type.match("video.*")&&(n.onload=function(){var e=new Blob([n.result],{type:r.type}),i=URL.createObjectURL(e),s=document.createElement("video"),a=function(){t()&&(s.removeEventListener("timeupdate",a),s.pause())};s.addEventListener("loadeddata",function(){t()&&s.removeEventListener("timeupdate",a)});var t=function(){var e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight,e.getContext("2d").drawImage(s,0,0,e.width,e.height);var a=e.toDataURL("image/jpeg"),t=1e5<a.length;if(t){var n=JSON.parse(l.find(".yz-attachment-data").val());n.video_thumbnail=a,l.find(".yz-attachment-data").val(JSON.stringify(n)),URL.revokeObjectURL(i)}return t};s.addEventListener("timeupdate",a),s.preload="metadata",s.src=i,s.muted=!0,s.playsInline=!0,s.play()},n.readAsArrayBuffer(r)),l.css("background-image","url("+t+"temp/"+a.original+")")},error:function(e,a,t){l.remove(),d.yz_DialogMsg("error",a),d.yz_CheckUploadProgress(i),d.yz_upload_next_file(i)}})},d.yz_upload_next_file=function(e){a++,null!==t&&void 0!==t.files[a]&&d.yz_UploadFile(e,t.files[a])},d(document).on("click",".yz-delete-attachment",function(e){var a=d(this).closest("form");a.hasClass("ac-form")?a.find(".yz-wall-upload-btn").fadeIn():"send-reply"!=a.attr("id")&&"send_message_form"!=a.attr("id")||a.find(".yz-upload-btn").fadeIn();var t=d(this).closest(".yz-attachment-item");if(t.find(".yz-attachment-data").get(0)){var n=d.parseJSON(t.find(".yz-attachment-data").val());d.yz_DeleteAttachment(a,n.original)}t.remove()}),d.yz_DeleteAttachment=function(e,a){var t=new FormData;t.append("attachment",a),t.append("security",Youzer.security_nonce),t.append("action","yz_delete_wall_attachment"),d.ajax({type:"POST",data:t,url:ajaxurl,contentType:!1,processData:!1})},d.yz_GetNameExcerpt=function(e){if(e.length<=25)return e;var a=25-"...".length,t=Math.ceil(a/2),n=Math.floor(a/2);return e.substr(0,t)+"..."+e.substr(e.length-n)},d.yz_CheckIsFileImage=function(e){var a=e.type;return!(d.inArray(a,["image/gif","image/jpeg","image/png"])<0)},d.yz_CheckUploadProgress=function(e){e.find(".yz-file-progress")[0]||(e.find(".yz-upload-attachments").val(""),e.find('.yz-wall-actions button[type="submit"]').attr("disabled",!1),a=0,t=null)},d.yz_CheckFilesNumber=function(e){var a=e.find('input:radio[name="post_type"]:checked').val();return"activity_photo"==a||"activity_slideshow"==a||!e.find(".yz-attachment-item")[0]||(t=null,d.yz_DialogMsg("error",Yz_Wall.max_one_file),!1)},d.yz_getUrlParameter=function(e,a){var t,n,i=e.split("&");for(n=0;n<i.length;n++)if((t=i[n].split("="))[0]===a)return void 0===t[1]||decodeURIComponent(t[1])}})}(jQuery);